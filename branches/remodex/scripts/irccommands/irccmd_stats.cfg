// show stats player or server
irccmd_stats = [
	infoline = ""
	if (=s $arg2 "") [  // show game info
		all = (allplayers)
		
		if (= $all 0) [
			infoline = "No one is connected"
		] [
		
			infoline = (modetostr (getmode))	// Capture
			infoline = (concat $infoline (getmap)) // Capture nevil_c  
			infoline = (concat $infoline (format "players: %1/%2" (numclients) $maxclients)) // Capture nevil_c players: 10/24
			if (!= (getmode) 1) [
				infoline = (concat $infoline (formatmillis "time left: %m:%s" (- $gamelimit $gamemillis))) // Capture nevil_c players: 10/24 time left: 09:50
	        ]
			if (isinlist $TEAMMODES (modetostr (getmode))) [ infoline = (concat $infoline (format "| good: %1 - evil: %2" (getteamscores "good") (getteamscores "evil"))) ]	// Capture nevil_c players: 10/24 time left: 09:50 | good: 42 evil: 26
	        
	        // Best 3 
	        
	        fpline = "|"
	        loop i	3 [
	        	n = (+ $i 1)
	        	looplist cn $all [     
	        		if (= (getrank $cn) $n) [
	        			fpline = (concat $fpline (format "%1. %2 (%3/%4 %5%%%%)" $n (getname $cn) (getfrags $cn) (getdeaths $cn) (getaccuracy $cn)))        		
	        		] 
	        	]               		        	        	        	
	        ]
	        
	        infoline = (concat $infoline $fpline) // Capture nevil_c players: 10/24 time left: 09:50 | good: 42 evil: 26 | 1. degrave (67/30 24%) 2. unnamed (2/60 5%)
        ]
	] [ // Player info
		if (playerexists $arg2) [
			infoline = (format "stast: %1 %2/%3 %4%%%% teamkils: %5 flags: %6 time online: %7" (getname $arg2) (getfrags $arg2) (getdeaths $arg2) (getaccuracy $arg2) (getteamkills $arg2) (getflags $arg2) (formatmillis "%h:%m:%s" (getonline $arg2)))
		] [
			infoline = (format "Player '%1' does not exists")
		]
	]
	
	ircsay $infoline
]

irc_registercommand "stats" irccmd_stats 0 "|c" "stats [cn]. Show game or player info"
