bestfrag = [
	bfrag = -1;
	bfrager = -1;
	all = (allactiveplayers)
	looplist cn $all [	
		numfrag = (getfrags $cn);
		if (> $numfrag $bfrag) [
			bfrag = $numfrag;
			bfrager = $cn
			];
	]
	res = ""
	looplist cn $all [
		if (= (getfrags $cn) $bfrag) [
			res = (concat $res $cn) 
		];
	]
echo $res
	result $res;
]

bestdeath = [
	bdeath = -1;
	bdeather = -1;
	all = (allactiveplayers)
	looplist cn $all [
		numdeath = (getdeaths $cn)
		if (> $numdeath $bdeath) [
			bdeath = $numdeath;
			bdeather = $cn
			];
	]
	res = ""
	looplist cn $all [
		if (= (getdeaths $cn) $bdeath) [
			res = (concat $res $cn) 
		];
	]
	result $res;
]

bestacc = [
	bacc = -1;
	baccer = -1;
	all = (allactiveplayers)
	looplist cn $all [
		numacc = (getaccuracy $cn);
		if (> $numacc $bacc) [
			bacc = $numacc;
			baccer = $cn
			];
	]
	res = ""
	looplist cn $all [
		if (= (getaccuracy $cn) $bacc) [
			res = (concat $res $cn) 
		];
	]
	result $res;
]

bestkpd = [
	bkpd = -1;
	bkpder = -1;
	all = (allactiveplayers)
	looplist cn $all [
		numkpd = (getkpd $cn);
		if (> $numkpd $bkpd) [
			bkpd = $numkpd;
			bkpder = $cn
			];
	]
	res = ""
	looplist cn $all [
		if (= (getkpd $cn) $bkpd) [
			res = (concat $res $cn) 
		];
	]
	result $res;
]

beststealflag = [
	bstf = -1;
	bstfer = -1;
	all = (allactiveplayers)
	looplist cn $all [
		numstf = (getflags $cn);
		if (> $numstf $bstf) [
			bstf = $numstf;
			bstfer = $cn
		];
	]
	res = ""
	looplist cn $all [
		if (= (getflags $cn) $bstf) [
			res = (concat $res $cn) 
		];
	]
	result $res;
]

bestreturnflag = [ //unimplemented yet
	bretf = -1;
	bretfer = -1;
	all = (allactiveplayers)
	looplist cn $all [
		numretf = (getretflags $cn);
		if (> $numretf $bretf) [
			bretf = $numretf
			bretfer = $cn
		]
	]
	res = ""
	looplist cn $all [
		if (= (getflags $cn) $bretf) [
			res = (concat $res $cn) 
		];
	]
	result $res;
]

srv_showbest = [
	awdline = "^f3Game awards:";
	
	players = (bestfrag);
	val = (getfrags (at $players 0))
	str = ""
	looplist p $players [
		str = (concat $str (getname $p)) 
	]  
	str = (prettylist $str)
	awdline = (concat $awdline (format "^f1Most frags: ^f0%1 ^f1(^f6%2^f1)" $str $val))
	
	players = (bestdeath);
	val = (getdeaths (at $players 0))
	str = ""
	looplist p $players [
		str = (concat $str (getname $p)) 
	]  
	str = (prettylist $str)
	awdline = (concat $awdline (format "^f1Cannon fodder: ^f0%1 ^f1(^f6%2^f1)" $str $val))
	
	players = (bestacc);
	val = (getaccuracy (at $players 0))
	str = ""
	looplist p $players [
		str = (concat $str (getname $p)) 
	]  
	str = (prettylist $str)
	awdline = (concat $awdline (format "^f1Accuracy: ^f0%1 ^f1(^f6%2%%^f1)" $str $val))
	
	//players = (bestkpd);
	//val = (getkpd (at $players 0))
	//str = ""
	//looplist p $players [
	//	str = (concat $str (getname $p)) 
	//]  
	//str = (prettylist $str)
	//awdline = (concat $awdline (format "^KpD: ^f0%1 ^f1(^f6%2^f1)" $str $val))
	
	if (isinlist $FLAGMODES (modetostr (getmode))) [//current gamemode has flags
		players = (beststealflag);
		val = (getflags (at $players 0))
		str = ""
		looplist p $players [
			str = (concat $str (getname $p)) 
		]  
		str = (prettylist $str)
		awdline = (concat $awdline (format "^Flags scored: ^f0%1 ^f1(^f6%2^f1)" $str $val))


		//players = (bestreturnflag);
		//val = (getretflags (at $players 0))
		//str = ""
		//looplist p $players [
		//	str = (concat $str (getname $p)) 
		//]  
		//str = (prettylist $str)
		//awdline = (concat $awdline (format "^Flag returner: ^f0%1 ^f1(^f6%2^f1)" $str $val))
	]

	say $awdline;
]

irc_showbest = [
	infoline = "GAME ENDED";  
	curr_mode = (modetostr (getmode))   
	infoline = (concat $infoline $curr_mode)  
	infoline = (concat $infoline (getmap))
	infoline = (concat $infoline (format "players: %1/%2" (numclients) $maxclients)) 	
	if (isinlist $TEAMMODES $curr_mode) [ //if current gamemode is team mode
		awdline = (concat $awdline (format "good: %1 evil: %2" (getteamscores "good") (getteamscores "evil")) 
	]          
	
	// Best 3
	if (> (numclients) 0) [
	    all = (allplayers)
	    fpline = "|"
	    loop i	3 [
	    	n = (+ $i 1)
	    	looplist cn $all [     
	    		if (= (getrank $cn) $n) [
	    			fpline = (concat $fpline (format "%1. %2 (%3/%4 %5%%%%)" $n (getname $cn) (getfrags $cn) (getdeaths $cn) (getaccuracy $cn)))        		
	    		] 
	    	]               		        	        	        	
	    ]                          
	    infoline = (concat $infoline $fpline)  
	]
	ircsay $infoline   
]

addhandler onimission srv_showbest
addhandler onimission irc_showbest
